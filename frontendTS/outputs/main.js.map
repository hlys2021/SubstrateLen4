{"version":3,"file":"main.js","sourceRoot":"","sources":["../main.ts"],"names":[],"mappings":"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","sourcesContent":["\nconst { ApiPromise, WsProvider } = require('@polkadot/api');\nconst { xxhashAsHex } = require('@polkadot/util-crypto');\n\n// const WEB_SOCKET = 'ws://localhost:9944';\nconst WEB_SOCKET = 'ws://127.0.0.1:9944';\n\nconst sleep = (ms: number | undefined) => new Promise(resolve => setTimeout(resolve, ms));\n\nconst connectSubstrate = async () => {\n    const wsProvider = new WsProvider(WEB_SOCKET);\n    const api = await ApiPromise.create({ provider: wsProvider, types: {} });\n    await api.isReady;\n    console.log(\"### connection to substrate successful!!!\")\n    return api;\n};\n\n\n//读取offchain storage的内容\nconst readOffchainStorage = async (api) => {\n    var count = 100;\n    while (count > 0) {\n\n        const offchainData = await api.rpc.offchain.localStorageGet('PERSISTENT', 'offchain_tx_key_for_test_1234567890');\n        // console.log('offchainStorage:', offchainData.toHuman());\n\n        if (offchainData.isSome) {\n            console.log('### offchainData:', offchainData.toHuman());\n            break;\n        } else {\n            console.log('### offchainData is empty!!! count=',count);\n        }\n        count--;\n        await sleep(2000);\n    }\n}\n\n\n//subscribe event on node templete\nconst subscribeEvent = async (api: typeof ApiPromise) => {\n    const eventName = 'templateModule.SomethingStored';\n    api.query.system.events((events) => {\n        events.forEach((record) => {\n            const { event } = record;\n            if (event.section === 'templateModule') { //订阅指定Module的Event(以templateModule为例)\n                console.log('Received custom event:', event.method, event.toHuman());\n            }\n        });\n    });\n}\n\n\n\n\nconst main = async () => {\n    const api = await connectSubstrate();\n    await readOffchainStorage(api);\n    await subscribeEvent(api);\n    await sleep(6000000);\n}\n\n\n\nmain()\n    .then(() => {\n        console.log(\"successfully exited\");\n        process.exit(0);\n    })\n    .catch(err => {\n        console.log('error occur:', err);\n        process.exit(1);\n    });\n\n\n"]}